<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.9.1 (457703)"/><meta name="altitude" content="98.49056243896484"/><meta name="author" content="Olaf Kotur"/><meta name="created" content="2019-04-16 08:06:28 +0000"/><meta name="latitude" content="52.6396484375"/><meta name="longitude" content="-1.19294028759748"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-04-18 14:53:40 +0000"/><title>15: File Systems</title></head><body><div><span style="font-weight: bold;">Access Control</span></div><ol><li><div>Read</div></li><li><div>Write</div></li><li><div>Execute</div></li><li><div>Append</div></li><li><div>Delete</div></li><li><div>List</div></li></ol><div><br/></div><div><span style="font-weight: bold;">Shared Files: </span>We can allow multiple links to a file and the file system becomes a Directed Acyclic Graph (DAG).</div><ul><li><div>However, supporting links to directories allows loops thus process can get stuck when scanning.</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Virtual File-system: </span>Common interface hides…</div><ul><li><div>File-system differences - such as network file systems</div></li><li><div>Multiple file systems</div></li></ul><div><img src="15%3A%20File%20Systems.html.resources/4BA888F9-3052-459A-87E9-A06EADC02AB1.png" height="596" width="776"/><br/></div><div><br/></div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 101px;"/><col style="width: 419px;"/></colgroup><tbody><tr><td colspan="2" style="width: 520px; padding: 8px; border: 1px solid;"><div style="text-align: center; "><span style="font-weight: bold;">Allocating Space for Files</span></div></td></tr><tr><td style="width: 101px; padding: 8px; border: 1px solid;"><div><span style="font-weight: bold;">Contiguous Allocation</span></div></td><td style="width: 419px; padding: 8px; border: 1px solid;"><ul><li><div>Each file fills set of adjacent disk blocks in filesystem</div></li><li><div>Need to know file sizes before finding gap for file</div></li><li><div>Suffers from external fragmentation - end up with free unused blocks between files as we canny split files.</div></li></ul></td></tr><tr><td style="width: 101px; padding: 8px; border: 1px solid;"><span style="font-weight: bold;">Linked-List Allocation</span></td><td style="width: 419px; padding: 8px; border: 1px solid;"><ul><li><div>Avoids external fragmentation problem as blocks no longer need to be contiguous.</div></li><li><div>Fragmentation confined to last block only.</div></li><li><div>Only offers sequential access</div></li><li><div><span style="font-weight: bold;">File Allocation Table (FAT): </span>Keeps track of all divided files scattered around memory to be able to put pieces back together.</div></li></ul></td></tr><tr><td style="width: 101px; padding: 8px; border: 1px solid;"><span style="font-weight: bold;">Indexed Allocation</span></td><td style="width: 419px; padding: 8px; border: 1px solid;"><ul><li><div>Dedicated index block - quick access to any position / address in a file.</div></li><li><div>Supports holes - deliberate 0s.</div></li><li><div><span style="font-weight: bold;">Linked: </span>Index points to block, simple and fast but limited to only n blocks.</div></li><li><div><span style="font-weight: bold;">Multi-level: </span>Index can point to more indexes.</div></li><li><div><span style="font-weight: bold;">Combined: </span>Can contain data blocks and indexes within the index blocks.</div></li></ul><div><img src="15%3A%20File%20Systems.html.resources/2DD92EF2-6E2E-4D9A-942E-78ABA9D5F485.png" height="432" width="926"/><br/></div></td></tr></tbody></table><div><br/></div></div><div><span style="font-weight: bold;">Unix Structure</span></div><ul><li><div><span style="font-weight: bold;">Reference Count: </span>Number of references to a single object.</div></li><li><div><span style="font-weight: bold;">Hard Link: </span>Contains the file name and node number - this points to the actual data. Once a data block doesn’t have a hard link then the file is deleted.</div></li><li><div><span style="font-weight: bold;">Symbolic Link: </span>Contains the file name and the pointer to the hard link - this just points to another pointer that points to the data.</div></li></ul><div><img src="15%3A%20File%20Systems.html.resources/B0DEF17C-4056-4542-A38B-A4F45E07F22B.png" height="1186" width="1196"/><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Super block</span></div><div><b><img src="15%3A%20File%20Systems.html.resources/9892D74E-9CAF-42C7-AFF2-D0F8DF9E1005.png" height="392" width="948"/><br/></b></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Directory Structure</span></div><div><b><img src="15%3A%20File%20Systems.html.resources/ABC53296-1EB7-4A41-866E-2E950849709C.png" height="308" width="1848"/><br/></b></div><div><b><img src="15%3A%20File%20Systems.html.resources/D84CAC46-24FE-4D0A-991F-255DBAFF2F8B.png" height="226" width="1012"/><br/></b></div><div><br/></div><div><br/></div><div><br/></div><hr/><div><br/></div><div><span style="font-weight: bold;">Kernel Tables: </span>Maintained cache of recently used nodes to speed up access, known as active node table.</div><ul><li><div>Accessed using hash of node + device ID</div></li><li><div>Stored in a LRU linked list where last place is claimed if no entry on freelist for newly active inode is available.</div></li></ul><div><br/></div><div><span style="font-weight: bold;">Buffering and Blocks</span></div><ul><li><div>Moving between disk blocks takes a lot of time and thus is expensive use of processing.</div></li><li><div>By caching a disk block we don’t have to spend as much time reading it.</div></li><li><div>Often use read-ahead method to speed up access <span style="font-weight: bold;">i.e. </span>read n blocks after the desired block.</div></li></ul><div><br/></div><div><span style="font-weight: bold;">Efficient Buffering</span></div><ul><li><div><span style="font-weight: bold;">Least Recently Used (LRU): </span>Move to top when used</div></li><li><div><span style="font-weight: bold;">Age: </span>Read ahead blocks and move to LRU list if used. This may or may not be used as this is a prediction only.</div></li><li><div><span style="font-weight: bold;">Empty: </span>Reusable headers to save re-creating structures.</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Filesystem Flush/Sync'd: </span>Clear the internal buffers on the disk. Use the dirty flag in the control bits to flush dirty buffers, system calls are used to force this - usually called when the system shuts down.</div><ol><li><div>Protects against lost data in event of system failure</div></li><li><div>Speed up reuse of LRU buffers</div></li></ol><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Delayed Allocation: </span>Buffers allow files to grow in memory - thus their memory allocation is delayed as they can grow at a later time then initially set up. This limits fragmentation.</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Extends: </span>Portions of file stored as contiguous set of disk blocks, file information contains the number of contiguous blocks in extent and the block address of the first block - makes file reads more efficient due to:</div><ol><li><div>Less meta-data <span style="font-weight: bold;">i.e. </span>block pointers and indexes</div></li><li><div>Less fragmentation</div></li><li><div>Less head movement</div></li></ol><div><br/></div><div><br/></div><div><span style="font-weight: bold;">POSIX File Locking - lock( ): </span>Often only way to coordinate unrelated applications.</div><ul><li><div><span style="font-weight: bold;">Shared Lock: </span>Any number of shared locks possible but can’t include any data under an exclusive lock.</div></li><li><div><span style="font-weight: bold;">Exclusive Lock: </span>Fails if any requested byte subject to existing locks.</div></li></ul><div><img src="15%3A%20File%20Systems.html.resources/B8B0F3C7-B592-4232-8EAF-7839358364D5.png" height="648" width="1022"/><br/></div><div><br/></div><br/></body></html>