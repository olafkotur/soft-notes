<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.9.1 (457703)"/><meta name="altitude" content="56.61385726928711"/><meta name="author" content="Olaf Kotur"/><meta name="created" content="2019-02-04 19:26:48 +0000"/><meta name="latitude" content="54.00814819335938"/><meta name="longitude" content="-2.784757530633049"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-05-13 11:11:57 +0000"/><title>02: Locks and Context Switching</title></head><body><div><span style="font-weight: bold;">Leveraging Hardware and Software</span></div><ul><li><div><span style="font-weight: bold;">Commoditisation: </span>Resource that is frequently used, doesn’t matter where it is from, able to mix and match hardware and it works.</div></li><li><div><span style="font-weight: bold;">Moore’s Law: </span>No longer in play - due to quantum tunnelling we can’t go smaller as electrons can go through material, can’t pull away heat effectively either.</div></li><li><div><span style="font-weight: bold;">OS &amp; VM: </span>Optimised to take advantage of multi-threading techniques to increase speed.</div></li></ul><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 202px;"/><col style="width: 468px;"/></colgroup><tbody><tr><td colspan="2" style="width: 670px; padding: 8px; border: 1px solid;"><div style="text-align: center; "><span style="font-weight: bold;">Benefits</span></div></td></tr><tr><td style="width: 202px; padding: 8px; border: 1px solid;"><span style="font-weight: bold;">Increased Performance: </span>More users exists and need for simultaneous computation.</td><td style="width: 468px; padding: 8px; border: 1px solid;"><ul><li><div>Embarrassingly parallel - little to no dependencies <span style="font-weight: bold;">i.e. </span>no coordination.</div></li><li><div>Divides large problems into smaller problems with organised communication. </div></li><li><div>Without multithreading, UI wouldn’t exist as it needs to do this simultaneously.</div></li></ul></td></tr><tr><td style="width: 202px; padding: 8px; border: 1px solid;"><div><span style="font-weight: bold;">Improved Responsiveness: </span>Not every compute platform supports latest hardware.</div></td><td style="width: 468px; padding: 8px; border: 1px solid;"><ul><li><div>Legacy hardware and legacy code may not support modern hardware and modern code - need concurrency to speed things up for this reason</div></li><li><div><span style="font-weight: bold;">Amdahl’s Law </span>- speedup is limited by serial part of program <span style="font-weight: bold;">e.g. </span>if 95% of program can be paralysed, theoretical max speed is x20.</div></li></ul></td></tr><tr><td style="width: 202px; padding: 8px; border: 1px solid;"><div><span style="font-weight: bold;">Complexities of Concurrency: </span>Simplifies process.</div></td><td style="width: 468px; padding: 8px; border: 1px solid;"><ul><li><div><span style="font-weight: bold;">Accidental complexity: </span>Low-level APIs, tedious, error-print.</div></li><li><div><span style="font-weight: bold;">Limited debug tools: </span>Lack of tools to identify and rectify race conditions.</div></li></ul></td></tr></tbody></table><div><br/></div></div><div><span style="font-weight: bold;">Race Condition: </span>Error or lost update that occurs due to multiple processes ‘racing’ in an uncontrolled manner though a section of non-atomic code. Occurs when output is dependent on the timing or sequence of uncontrolled events. </div><div><br/></div><div><img src="02%3A%20Locks%20and%20Context%20Switching.html.resources/8063B8BA-E3A0-4B96-92E0-8CFF827A41D7.png" height="665" width="1600"/><br/></div><div><br/></div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 331px;"/><col style="width: 331px;"/></colgroup><tbody><tr><td style="width: 331px; padding: 8px; border: 1px solid;"><div style="text-align: center; "><span style="font-weight: bold;">Competition</span></div></td><td style="width: 331px; padding: 8px; border: 1px solid;"><div style="text-align: center; "><span style="font-weight: bold;">Coor dination</span></div></td></tr><tr><td style="width: 331px; padding: 8px; border: 1px solid;"><div>Competing for a variable that two processes want to read or update simultaneously.</div><ul><li><div><span style="font-weight: bold;">Critical Section: </span>Region of code that must be projected from shared resource of multiple threads.</div></li><li><div><span style="font-weight: bold;">Shared resource: </span>Data structure, device, network connection.</div></li><li><div><span style="font-weight: bold;">Lost update: </span>Another process can overwrite a variable.</div></li></ul></td><td style="width: 331px; padding: 8px; border: 1px solid;"><div>One process wants to tell another process that is ready to use their data.</div><ul><li><div>Manages order or time to ensure threads access system resources correctly.</div></li><li><div>Without this, a variable may be read wrongly or overwritten.</div></li></ul></td></tr></tbody></table><div><br/></div></div><div><span style="font-weight: bold;">Determinism</span></div><ul><li><div><span style="font-weight: bold;">Indeterminate: </span>Different results every time <span style="font-weight: bold;">e.g. </span>random numbers.</div></li><li><div><span style="font-weight: bold;">Deterministic: </span>Computation has the same outcome every time <span style="font-weight: bold;">e.g. </span>adding numbers.</div></li></ul><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 132px;"/><col style="width: 543px;"/></colgroup><tbody><tr><td colspan="2" style="width: 675px; padding: 8px; border: 1px solid;"><div style="text-align: center; "><span style="font-weight: bold;">Critical Section Properties: </span>Area where race conditions apply</div></td></tr><tr><td style="width: 132px; padding: 8px; border: 1px solid;"><div><span style="font-weight: bold;">Bounded waiting</span></div></td><td style="width: 543px; padding: 8px; border: 1px solid;"><div>Threads waiting to enter critical section will eventually enter or leave.</div></td></tr><tr><td style="width: 132px; padding: 8px; border: 1px solid;"><span style="font-weight: bold;">Mutual Exclusion</span></td><td style="width: 543px; padding: 8px; border: 1px solid;"><div>Only one thread can run within critical section at any given time.</div></td></tr><tr><td style="width: 132px; padding: 8px; border: 1px solid;"><div><span style="font-weight: bold;">Performance</span></div></td><td style="width: 543px; padding: 8px; border: 1px solid;"><div>Minimised overhead for entering/exiting</div></td></tr><tr><td style="width: 132px; padding: 8px; border: 1px solid;"><div><span style="font-weight: bold;">Fairness</span></div></td><td style="width: 543px; padding: 8px; border: 1px solid;"><div>Suitable waiting times for threads.</div></td></tr><tr><td style="width: 132px; padding: 8px; border: 1px solid;"><span style="font-weight: bold;">Progress</span></td><td style="width: 543px; padding: 8px; border: 1px solid;"><div>Thread outside critical section, it cannot stop other threads from entering. </div></td></tr></tbody></table><div><br/></div></div><div><span style="font-weight: bold;">Synchronisation Solutions</span></div><ul><li><div><span style="font-weight: bold;">Atomicity: </span>Only one process should be accessing a critical section at a time.</div></li><li><div><span style="font-weight: bold;">Condition Synchronisation: </span>Second process will wait for first process to finish before accessing.</div></li></ul><div><br/></div><div><br/></div><hr/><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Locks: </span>Mutual exclusion mechanism that limits resource access in a multi-threaded environment.</div><ul><li><div>Compromises of two states</div></li><ul><li><div><span style="font-weight: bold;">Held:</span> Thread is within the critical section and no-one should enter.</div></li><li><div><span style="font-weight: bold;">Not Held:</span> No thread within the critical section and a process can enter.</div></li></ul><li><div>Two operations that move locks between states</div></li><ul><li><div><span style="font-weight: bold;">Acquire: </span>Mark lock as held, or wait until release</div></li><li><div><span style="font-weight: bold;">Release: </span>Mark as not held</div></li></ul></ul><div><img src="02%3A%20Locks%20and%20Context%20Switching.html.resources/35CC61C5-5245-46B1-9868-9296FCFB9C57.png" height="603" width="1210"/><br/></div><div><br/></div><div><span style="font-weight: bold;">Mutual Exclusion in Java Method</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>public class Bank_account {</div><div>    private int bal = 0;</div><div>    </div><div>    public void Bank_account(int start_balance) {</div><div>        bal = start_balance; </div><div>    }</div><div>    </div><div>    public void synchronized update(int amount) {</div><div>        bal = balance + amount;</div><div>    }</div><div>}</div></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Mutual Exclusion in Java Code Block</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>public class Bank_account {</div><div>    Private Object lockA = new Object();</div><div>    private int bal = 0;</div><div>    public void update(int amount) {</div><div>        synchronized (lock1) {</div><div>            try { </div><div>                Thread.sleep(1); //Should we have this?</div><div>            }</div><div>            catch(InterruptedException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>            bal = balance + amount;</div><div>        }</div><div>    }</div><div>}</div></div><div><br/></div><div><br/></div><div><img src="02%3A%20Locks%20and%20Context%20Switching.html.resources/6D95880B-4A5E-474D-B414-C345AA6A6887.png" height="896" width="730"/><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Context Switching: </span>Store context information for a switched-out thread so can later resume exactly where it left off</div><ul><li><div>Compromises of place in the program that the thread is executing</div></li><li><div>Or place in the stack that remembers the sequence of function calls the thread is making as it executes program</div></li><li><div>Holds info on two key machine registers </div></li><ul><li><div><span style="font-weight: bold;">Program Counter:</span> Instruction address the thread is at in its program</div></li><li><div><span style="font-weight: bold;">Stack Pointer:</span> Address of top of the thread’s stack</div></li></ul></ul><div><br/></div><div><span style="font-weight: bold;">Three-step context-switching sequence</span></div><div><img src="02%3A%20Locks%20and%20Context%20Switching.html.resources/34DD826D-F088-4578-95F3-0DE87DA3156B.png" height="632" width="1352"/><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>